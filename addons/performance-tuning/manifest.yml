type: update
name: DB Cluster Tuning (Alpha)
id: proxysql-db-tune-addon
logo: addons/performance-tuning/images/mysql-proxysql-tuning.png
description: Change ProxySQL and Database settings according to your particular use case
baseUrl: https://raw.githubusercontent.com/sych74/mysql-cluster/JE-66111

onInstall:
  - if (!nodes.proxy):
      return:
        type: warning
        message: Add-on does not provide performance tuning without ProxySQL nodes.

  - script: |
        var nodeGroups, resp, scheme = "";
        resp = api.env.control.GetNodeGroups("${env.name}", session);
        if (resp.result != 0) return resp;
        nodeGroups = resp.object;
        for (var i = 0, n = nodeGroups.length; i < n; i++) {
          if (nodeGroups[i].name == 'sqldb' && nodeGroups[i].cluster && nodeGroups[i].cluster.enabled && nodeGroups[i].cluster.settings.scheme) {
            scheme = nodeGroups[i].cluster.settings.scheme;
          }
        }
        
        return { result: 0, scheme: scheme};
